import { expect, describe, it, beforeAll } from "vitest";
import { createOperator, transform } from "./operators.js";

import type cvReadyPromiseType from "@techstark/opencv-js";
import ndarray, { type NdArray } from "ndarray";
import type { DataValues } from "../types/type.js";
import { matToLine, ndArrayToList } from "./func.js";

let cv: Awaited<typeof cvReadyPromiseType>;

beforeAll(async () => {
  /// @ts-ignore
  const cvReadyPromise = require("@techstark/opencv-js");
  cv = await cvReadyPromise;
});

describe("transform", () => {
  it("simple case", () => {
    const result_1000 = [
      -2.1179039478302, -2.0665297508239746, -2.015155553817749,
      -1.9637812376022339, -1.9124069213867188, -1.8610327243804932,
      -1.809658408164978, -1.7582842111587524, -1.7069098949432373,
      -1.6555356979370117, -1.6041613817214966, -1.552787184715271,
      -1.5014128684997559, -1.4500386714935303, -1.3986643552780151,
      -1.3472901582717896, -1.2959157228469849, -1.2445414066314697,
      -1.1931672096252441, -1.141792893409729, -1.0904186964035034,
      -1.0390443801879883, -0.9876701831817627, -0.9362959265708923,
      -0.884921669960022, -0.8335474133491516, -0.7821731567382812,
      -0.7307989001274109, -0.6794246435165405, -0.6280503869056702,
      -0.5766761302947998, -0.5253018736839294, -0.47392746806144714,
      -0.4225532114505768, -0.3711789548397064, -0.31980469822883606,
      -0.2684304118156433, -0.21705617010593414, -0.16568191349506378,
      -0.11430764943361282, -0.06293339282274246, -0.0115591362118721,
      0.03981512039899826, 0.09118937700986862, 0.14256364107131958,
      0.19393789768218994, 0.2453121542930603, 0.29668641090393066,
      0.348060667514801, 0.3994349241256714, 0.45080918073654175,
      0.5021834373474121, 0.5535576939582825, 0.6049319505691528,
      0.6563062071800232, 0.7076804637908936, 0.7590547204017639,
      0.8104289770126343, 0.8618032336235046, 0.913177490234375,
      0.9645517468452454, 1.0159260034561157, 1.0673003196716309,
      1.1186745166778564, 1.1700490713119507, 1.2214232683181763,
      1.2727975845336914, 1.324171781539917, 1.3755460977554321,
      1.4269202947616577, 1.4782946109771729, 1.5296688079833984,
      1.5810431241989136, 1.6324173212051392, 1.6837916374206543,
      1.7351659536361694, 1.786540150642395, 1.8379144668579102,
      1.8892886638641357, 1.9406629800796509, 1.9920371770858765,
      2.0434114933013916, 2.094785690307617, 2.1461598873138428,
      2.1975343227386475, 2.248908281326294, -2.0836544036865234,
      -2.032280206680298, -1.9809060096740723, -1.9295316934585571,
      -1.878157377243042, -1.8267831802368164, -1.7754088640213013,
      -1.7240346670150757, -1.6726603507995605, -1.621286153793335,
      -1.5699118375778198, -1.5185376405715942, -1.467163324356079,
      -1.4157891273498535, -1.3644148111343384, -1.3130406141281128,
      -1.261666178703308, -1.2102919816970825, -1.1589176654815674,
      -1.1075434684753418, -1.0561691522598267, -1.004794955253601,
      -0.9534206390380859, -0.9020463824272156, -0.8506721258163452,
      -0.7992978692054749, -0.7479236125946045, -0.6965493559837341,
      -0.6451750993728638, -0.5938008427619934, -0.542426586151123,
      -0.4910523295402527, -0.4396779537200928, -0.3883036971092224,
      -0.33692944049835205, -0.2855551838874817, -0.23418092727661133,
      -0.18280665576457977, -0.1314323991537094, -0.08005814999341965,
      -0.028683889657258987, 0.022690368816256523, 0.07406462728977203,
      0.1254388839006424, 0.17681314051151276, 0.22818739712238312,
      0.2795616686344147, 0.33093592524528503, 0.3823101818561554,
      0.43368443846702576, 0.4850586950778961, 0.5364329218864441,
      0.5878071784973145, 0.6391814351081848, 0.6905557513237,
      0.7419300079345703, 0.7933042645454407, 0.844678521156311,
      0.8960527777671814, 0.9474270343780518, 0.9988012909889221,
      1.0501755475997925, 1.101549744606018, 1.1529240608215332,
      1.2042986154556274, 1.255672812461853, 1.3070471286773682,
      1.3584213256835938, 1.4097956418991089, 1.4611698389053345,
      1.5125441551208496, 1.5639183521270752, 1.6152926683425903,
      1.666666865348816, 1.718041181564331, 1.7694153785705566,
      1.8207896947860718, 1.8721638917922974, 1.9235382080078125,
      1.974912405014038, 2.0262866020202637, 2.0776610374450684,
      2.129035234451294, 2.1804094314575195, 2.231783628463745,
      -2.1007792949676514, -2.0494048595428467, -1.998030662536621,
      -1.9466564655303955, -1.8952821493148804, -1.8439079523086548,
      -1.7925336360931396, -1.741159439086914, -1.689785122871399,
      -1.6384109258651733, -1.5870366096496582, -1.5356624126434326,
      -1.4842880964279175, -1.432913899421692, -1.3815395832061768,
      -1.3301653861999512, -1.2787909507751465, -1.227416753768921,
      -1.1760424375534058, -1.1246682405471802, -1.073293924331665,
      -1.0219197273254395, -0.9705454111099243, -0.919171154499054,
      -0.8677968978881836, -0.8164226412773132, -0.7650483846664429,
      -0.7136741280555725, -0.6622998714447021, -0.6109256148338318,
      -0.5595513582229614, -0.5081771016120911, -0.45680269598960876,
      -0.4054284393787384, -0.35405418276786804, -0.3026799261569977,
      -0.2513056695461273, -0.19993141293525696, -0.1485571563243866,
      -0.09718289971351624, -0.045808643102645874, 0.005565616302192211,
      0.05693987384438515, 0.1083141341805458, 0.15968838334083557,
      0.21106265485286713, 0.2624368965625763, 0.31381115317344666,
      0.365185409784317, 0.4165596663951874, 0.46793392300605774,
      0.5193082094192505, 0.5706824660301208, 0.6220567226409912,
      0.6734309792518616, 0.7248052358627319, 0.7761794924736023,
      0.8275537490844727, 0.878928005695343, 0.9303022623062134,
      0.9816765189170837, 1.033050775527954, 1.0844250917434692,
      1.1357992887496948, 1.187173843383789, 1.2385480403900146,
      1.2899223566055298, 1.3412965536117554, 1.3926708698272705,
      1.444045066833496, 1.4954193830490112, 1.5467935800552368,
      1.598167896270752, 1.6495420932769775, 1.7009164094924927,
      1.7522906064987183, 1.8036649227142334, 1.855039119720459,
      1.9064134359359741, 1.9577876329421997, 2.009161949157715,
      2.0605361461639404, 2.111910343170166, 2.1632847785949707,
      2.2146589756011963, -2.1179039478302, -2.0665297508239746,
      -2.015155553817749, -1.9637812376022339, -1.9124069213867188,
      -1.8610327243804932, -1.809658408164978, -1.7582842111587524,
      -1.7069098949432373, -1.6555356979370117, -1.6041613817214966,
      -1.552787184715271, -1.5014128684997559, -1.4500386714935303,
      -1.3986643552780151, -1.3472901582717896, -1.2959157228469849,
      -1.2445414066314697, -1.1931672096252441, -1.141792893409729,
      -1.0904186964035034, -1.0390443801879883, -0.9876701831817627,
      -0.9362959265708923, -0.884921669960022, -0.8335474133491516,
      -0.7821731567382812, -0.7307989001274109, -0.6794246435165405,
      -0.6280503869056702, -0.5766761302947998, -0.5253018736839294,
      -0.47392746806144714, -0.4225532114505768, -0.3711789548397064,
      -0.31980469822883606, -0.2684304118156433, -0.21705617010593414,
      -0.16568191349506378, -0.11430764943361282, -0.06293339282274246,
      -0.0115591362118721, 0.03981512039899826, 0.09118937700986862,
      0.14256364107131958, 0.19393789768218994, 0.2453121542930603,
      0.29668641090393066, 0.348060667514801, 0.3994349241256714,
      0.45080918073654175, 0.5021834373474121, 0.5535576939582825,
      0.6049319505691528, 0.6563062071800232, 0.7076804637908936,
      0.7590547204017639, 0.8104289770126343, 0.8618032336235046,
      0.913177490234375, 0.9645517468452454, 1.0159260034561157,
      1.0673003196716309, 1.1186745166778564, 1.1700490713119507,
      1.2214232683181763, 1.2727975845336914, 1.324171781539917,
      1.3755460977554321, 1.4269202947616577, 1.4782946109771729,
      1.5296688079833984, 1.5810431241989136, 1.6324173212051392,
      1.6837916374206543, 1.7351659536361694, 1.786540150642395,
      1.8379144668579102, 1.8892886638641357, 1.9406629800796509,
      1.9920371770858765, 2.0434114933013916, 2.094785690307617,
      2.1461598873138428, 2.1975343227386475, 2.248908281326294,
      -2.0836544036865234, -2.032280206680298, -1.9809060096740723,
      -1.9295316934585571, -1.878157377243042, -1.8267831802368164,
      -1.7754088640213013, -1.7240346670150757, -1.6726603507995605,
      -1.621286153793335, -1.5699118375778198, -1.5185376405715942,
      -1.467163324356079, -1.4157891273498535, -1.3644148111343384,
      -1.3130406141281128, -1.261666178703308, -1.2102919816970825,
      -1.1589176654815674, -1.1075434684753418, -1.0561691522598267,
      -1.004794955253601, -0.9534206390380859, -0.9020463824272156,
      -0.8506721258163452, -0.7992978692054749, -0.7479236125946045,
      -0.6965493559837341, -0.6451750993728638, -0.5938008427619934,
      -0.542426586151123, -0.4910523295402527, -0.4396779537200928,
      -0.3883036971092224, -0.33692944049835205, -0.2855551838874817,
      -0.23418092727661133, -0.18280665576457977, -0.1314323991537094,
      -0.08005814999341965, -0.028683889657258987, 0.022690368816256523,
      0.07406462728977203, 0.1254388839006424, 0.17681314051151276,
      0.22818739712238312, 0.2795616686344147, 0.33093592524528503,
      0.3823101818561554, 0.43368443846702576, 0.4850586950778961,
      0.5364329218864441, 0.5878071784973145, 0.6391814351081848,
      0.6905557513237, 0.7419300079345703, 0.7933042645454407,
      0.844678521156311, 0.8960527777671814, 0.9474270343780518,
      0.9988012909889221, 1.0501755475997925, 1.101549744606018,
      1.1529240608215332, 1.2042986154556274, 1.255672812461853,
      1.3070471286773682, 1.3584213256835938, 1.4097956418991089,
      1.4611698389053345, 1.5125441551208496, 1.5639183521270752,
      1.6152926683425903, 1.666666865348816, 1.718041181564331,
      1.7694153785705566, 1.8207896947860718, 1.8721638917922974,
      1.9235382080078125, 1.974912405014038, 2.0262866020202637,
      2.0776610374450684, 2.129035234451294, 2.1804094314575195,
      2.231783628463745, -2.1007792949676514, -2.0494048595428467,
      -1.998030662536621, -1.9466564655303955, -1.8952821493148804,
      -1.8439079523086548, -1.7925336360931396, -1.741159439086914,
      -1.689785122871399, -1.6384109258651733, -1.5870366096496582,
      -1.5356624126434326, -1.4842880964279175, -1.432913899421692,
      -1.3815395832061768, -1.3301653861999512, -1.2787909507751465,
      -1.227416753768921, -1.1760424375534058, -1.1246682405471802,
      -1.073293924331665, -1.0219197273254395, -0.9705454111099243,
      -0.919171154499054, -0.8677968978881836, -0.8164226412773132,
      -0.7650483846664429, -0.7136741280555725, -0.6622998714447021,
      -0.6109256148338318, -0.5595513582229614, -0.5081771016120911,
      -0.45680269598960876, -0.4054284393787384, -0.35405418276786804,
      -0.3026799261569977, -0.2513056695461273, -0.19993141293525696,
      -0.1485571563243866, -0.09718289971351624, -0.045808643102645874,
      0.005565616302192211, 0.05693987384438515, 0.1083141341805458,
      0.15968838334083557, 0.21106265485286713, 0.2624368965625763,
      0.31381115317344666, 0.365185409784317, 0.4165596663951874,
      0.46793392300605774, 0.5193082094192505, 0.5706824660301208,
      0.6220567226409912, 0.6734309792518616, 0.7248052358627319,
      0.7761794924736023, 0.8275537490844727, 0.878928005695343,
      0.9303022623062134, 0.9816765189170837, 1.033050775527954,
      1.0844250917434692, 1.1357992887496948, 1.187173843383789,
      1.2385480403900146, 1.2899223566055298, 1.3412965536117554,
      1.3926708698272705, 1.444045066833496, 1.4954193830490112,
      1.5467935800552368, 1.598167896270752, 1.6495420932769775,
      1.7009164094924927, 1.7522906064987183, 1.8036649227142334,
      1.855039119720459, 1.9064134359359741, 1.9577876329421997,
      2.009161949157715, 2.0605361461639404, 2.111910343170166,
      2.1632847785949707, 2.2146589756011963, -2.1179039478302,
      -2.0665297508239746, -2.015155553817749, -1.9637812376022339,
      -1.9124069213867188, -1.8610327243804932, -1.809658408164978,
      -1.7582842111587524, -1.7069098949432373, -1.6555356979370117,
      -1.6041613817214966, -1.552787184715271, -1.5014128684997559,
      -1.4500386714935303, -1.3986643552780151, -1.3472901582717896,
      -1.2959157228469849, -1.2445414066314697, -1.1931672096252441,
      -1.141792893409729, -1.0904186964035034, -1.0390443801879883,
      -0.9876701831817627, -0.9362959265708923, -0.884921669960022,
      -0.8335474133491516, -0.7821731567382812, -0.7307989001274109,
      -0.6794246435165405, -0.6280503869056702, -0.5766761302947998,
      -0.5253018736839294, -0.47392746806144714, -0.4225532114505768,
      -0.3711789548397064, -0.31980469822883606, -0.2684304118156433,
      -0.21705617010593414, -0.16568191349506378, -0.11430764943361282,
      -0.06293339282274246, -0.0115591362118721, 0.03981512039899826,
      0.09118937700986862, 0.14256364107131958, 0.19393789768218994,
      0.2453121542930603, 0.29668641090393066, 0.348060667514801,
      0.3994349241256714, 0.45080918073654175, 0.5021834373474121,
      0.5535576939582825, 0.6049319505691528, 0.6563062071800232,
      0.7076804637908936, 0.7590547204017639, 0.8104289770126343,
      0.8618032336235046, 0.913177490234375, 0.9645517468452454,
      1.0159260034561157, 1.0673003196716309, 1.1186745166778564,
      1.1700490713119507, 1.2214232683181763, 1.2727975845336914,
      1.324171781539917, 1.3755460977554321, 1.4269202947616577,
      1.4782946109771729, 1.5296688079833984, 1.5810431241989136,
      1.6324173212051392, 1.6837916374206543, 1.7351659536361694,
      1.786540150642395, 1.8379144668579102, 1.8892886638641357,
      1.9406629800796509, 1.9920371770858765, 2.0434114933013916,
      2.094785690307617, 2.1461598873138428, 2.1975343227386475,
      2.248908281326294, -2.0836544036865234, -2.032280206680298,
      -1.9809060096740723, -1.9295316934585571, -1.878157377243042,
      -1.8267831802368164, -1.7754088640213013, -1.7240346670150757,
      -1.6726603507995605, -1.621286153793335, -1.5699118375778198,
      -1.5185376405715942, -1.467163324356079, -1.4157891273498535,
      -1.3644148111343384, -1.3130406141281128, -1.261666178703308,
      -1.2102919816970825, -1.1589176654815674, -1.1075434684753418,
      -1.0561691522598267, -1.004794955253601, -0.9534206390380859,
      -0.9020463824272156, -0.8506721258163452, -0.7992978692054749,
      -0.7479236125946045, -0.6965493559837341, -0.6451750993728638,
      -0.5938008427619934, -0.542426586151123, -0.4910523295402527,
      -0.4396779537200928, -0.3883036971092224, -0.33692944049835205,
      -0.2855551838874817, -0.23418092727661133, -0.18280665576457977,
      -0.1314323991537094, -0.08005814999341965, -0.028683889657258987,
      0.022690368816256523, 0.07406462728977203, 0.1254388839006424,
      0.17681314051151276, 0.22818739712238312, 0.2795616686344147,
      0.33093592524528503, 0.3823101818561554, 0.43368443846702576,
      0.4850586950778961, 0.5364329218864441, 0.5878071784973145,
      0.6391814351081848, 0.6905557513237, 0.7419300079345703,
      0.7933042645454407, 0.844678521156311, 0.8960527777671814,
      0.9474270343780518, 0.9988012909889221, 1.0501755475997925,
      1.101549744606018, 1.1529240608215332, 1.2042986154556274,
      1.255672812461853, 1.3070471286773682, 1.3584213256835938,
      1.4097956418991089, 1.4611698389053345, 1.5125441551208496,
      1.5639183521270752, 1.6152926683425903, 1.666666865348816,
      1.718041181564331, 1.7694153785705566, 1.8207896947860718,
      1.8721638917922974, 1.9235382080078125, 1.974912405014038,
      2.0262866020202637, 2.0776610374450684, 2.129035234451294,
      2.1804094314575195, 2.231783628463745, -2.1007792949676514,
      -2.0494048595428467, -1.998030662536621, -1.9466564655303955,
      -1.8952821493148804, -1.8439079523086548, -1.7925336360931396,
      -1.741159439086914, -1.689785122871399, -1.6384109258651733,
      -1.5870366096496582, -1.5356624126434326, -1.4842880964279175,
      -1.432913899421692, -1.3815395832061768, -1.3301653861999512,
      -1.2787909507751465, -1.227416753768921, -1.1760424375534058,
      -1.1246682405471802, -1.073293924331665, -1.0219197273254395,
      -0.9705454111099243, -0.919171154499054, -0.8677968978881836,
      -0.8164226412773132, -0.7650483846664429, -0.7136741280555725,
      -0.6622998714447021, -0.6109256148338318, -0.5595513582229614,
      -0.5081771016120911, -0.45680269598960876, -0.4054284393787384,
      -0.35405418276786804, -0.3026799261569977, -0.2513056695461273,
      -0.19993141293525696, -0.1485571563243866, -0.09718289971351624,
      -0.045808643102645874, 0.005565616302192211, 0.05693987384438515,
      0.1083141341805458, 0.15968838334083557, 0.21106265485286713,
      0.2624368965625763, 0.31381115317344666, 0.365185409784317,
      0.4165596663951874, 0.46793392300605774, 0.5193082094192505,
      0.5706824660301208, 0.6220567226409912, 0.6734309792518616,
      0.7248052358627319, 0.7761794924736023, 0.8275537490844727,
      0.878928005695343, 0.9303022623062134, 0.9816765189170837,
      1.033050775527954, 1.0844250917434692, 1.1357992887496948,
      1.187173843383789, 1.2385480403900146, 1.2899223566055298,
      1.3412965536117554, 1.3926708698272705, 1.444045066833496,
      1.4954193830490112, 1.5467935800552368, 1.598167896270752,
      1.6495420932769775, 1.7009164094924927, 1.7522906064987183,
      1.8036649227142334, 1.855039119720459, 1.9064134359359741,
      1.9577876329421997, 2.009161949157715, 2.0605361461639404,
      2.111910343170166, 2.1632847785949707, 2.2146589756011963,
      -2.1179039478302, -2.0665297508239746, -2.015155553817749,
      -1.9637812376022339, -1.9124069213867188, -1.8610327243804932,
      -1.809658408164978, -1.7582842111587524, -1.7069098949432373,
      -1.6555356979370117, -1.6041613817214966, -1.552787184715271,
      -1.5014128684997559, -1.4500386714935303, -1.3986643552780151,
      -1.3472901582717896, -1.2959157228469849, -1.2445414066314697,
      -1.1931672096252441, -1.141792893409729, -1.0904186964035034,
      -1.0390443801879883, -0.9876701831817627, -0.9362959265708923,
      -0.884921669960022, -0.8335474133491516, -0.7821731567382812,
      -0.7307989001274109, -0.6794246435165405, -0.6280503869056702,
      -0.5766761302947998, -0.5253018736839294, -0.47392746806144714,
      -0.4225532114505768, -0.3711789548397064, -0.31980469822883606,
      -0.2684304118156433, -0.21705617010593414, -0.16568191349506378,
      -0.11430764943361282, -0.06293339282274246, -0.0115591362118721,
      0.03981512039899826, 0.09118937700986862, 0.14256364107131958,
      0.19393789768218994, 0.2453121542930603, 0.29668641090393066,
      0.348060667514801, 0.3994349241256714, 0.45080918073654175,
      0.5021834373474121, 0.5535576939582825, 0.6049319505691528,
      0.6563062071800232, 0.7076804637908936, 0.7590547204017639,
      0.8104289770126343, 0.8618032336235046, 0.913177490234375,
      0.9645517468452454, 1.0159260034561157, 1.0673003196716309,
      1.1186745166778564, 1.1700490713119507, 1.2214232683181763,
      1.2727975845336914, 1.324171781539917, 1.3755460977554321,
      1.4269202947616577, 1.4782946109771729, 1.5296688079833984,
      1.5810431241989136, 1.6324173212051392, 1.6837916374206543,
      1.7351659536361694, 1.786540150642395, 1.8379144668579102,
      1.8892886638641357, 1.9406629800796509, 1.9920371770858765,
      2.0434114933013916, 2.094785690307617, 2.1461598873138428,
      2.1975343227386475, 2.248908281326294, -2.0836544036865234,
      -2.032280206680298, -1.9809060096740723, -1.9295316934585571,
      -1.878157377243042, -1.8267831802368164, -1.7754088640213013,
      -1.7240346670150757, -1.6726603507995605, -1.621286153793335,
      -1.5699118375778198, -1.5185376405715942, -1.467163324356079,
      -1.4157891273498535, -1.3644148111343384, -1.3130406141281128,
      -1.261666178703308, -1.2102919816970825, -1.1589176654815674,
      -1.1075434684753418, -1.0561691522598267, -1.004794955253601,
      -0.9534206390380859, -0.9020463824272156, -0.8506721258163452,
      -0.7992978692054749, -0.7479236125946045, -0.6965493559837341,
      -0.6451750993728638, -0.5938008427619934, -0.542426586151123,
      -0.4910523295402527, -0.4396779537200928, -0.3883036971092224,
      -0.33692944049835205, -0.2855551838874817, -0.23418092727661133,
      -0.18280665576457977, -0.1314323991537094, -0.08005814999341965,
      -0.028683889657258987, 0.022690368816256523, 0.07406462728977203,
      0.1254388839006424, 0.17681314051151276, 0.22818739712238312,
      0.2795616686344147, 0.33093592524528503, 0.3823101818561554,
      0.43368443846702576, 0.4850586950778961, 0.5364329218864441,
      0.5878071784973145, 0.6391814351081848, 0.6905557513237,
      0.7419300079345703, 0.7933042645454407, 0.844678521156311,
      0.8960527777671814, 0.9474270343780518, 0.9988012909889221,
      1.0501755475997925, 1.101549744606018, 1.1529240608215332,
      1.2042986154556274, 1.255672812461853, 1.3070471286773682,
      1.3584213256835938, 1.4097956418991089, 1.4611698389053345,
      1.5125441551208496, 1.5639183521270752, 1.6152926683425903,
      1.666666865348816, 1.718041181564331, 1.7694153785705566,
      1.8207896947860718, 1.8721638917922974, 1.9235382080078125,
      1.974912405014038, 2.0262866020202637, 2.0776610374450684,
      2.129035234451294, 2.1804094314575195, 2.231783628463745,
      -2.1007792949676514, -2.0494048595428467, -1.998030662536621,
      -1.9466564655303955, -1.8952821493148804, -1.8439079523086548,
      -1.7925336360931396, -1.741159439086914, -1.689785122871399,
      -1.6384109258651733, -1.5870366096496582, -1.5356624126434326,
      -1.4842880964279175, -1.432913899421692, -1.3815395832061768,
      -1.3301653861999512, -1.2787909507751465, -1.227416753768921,
      -1.1760424375534058, -1.1246682405471802, -1.073293924331665,
      -1.0219197273254395, -0.9705454111099243, -0.919171154499054,
      -0.8677968978881836, -0.8164226412773132, -0.7650483846664429,
      -0.7136741280555725, -0.6622998714447021, -0.6109256148338318,
      -0.5595513582229614, -0.5081771016120911, -0.45680269598960876,
      -0.4054284393787384, -0.35405418276786804, -0.3026799261569977,
      -0.2513056695461273, -0.19993141293525696, -0.1485571563243866,
      -0.09718289971351624, -0.045808643102645874, 0.005565616302192211,
      0.05693987384438515, 0.1083141341805458, 0.15968838334083557,
      0.21106265485286713, 0.2624368965625763, 0.31381115317344666,
      0.365185409784317, 0.4165596663951874, 0.46793392300605774,
      0.5193082094192505, 0.5706824660301208, 0.6220567226409912,
      0.6734309792518616, 0.7248052358627319, 0.7761794924736023,
      0.8275537490844727, 0.878928005695343, 0.9303022623062134,
      0.9816765189170837,
    ].map((num) => Math.trunc(num * 1e4) / 1e4);

    const preprocess_op = [
      createOperator({
        type: "DetResizeForTest",
        params: {
          cv: cv,
          limit_side_len: 960,
          limit_type: "max",
        },
      }),
      createOperator({
        type: "NormalizeImage",
        params: {
          cv: cv,
          std: [0.229, 0.224, 0.225],
          mean: [0.485, 0.456, 0.406],
          scale: 1.0 / 255.0,
          order: "hwc",
        },
      }),
      createOperator({
        type: "ToCHWImage",
        params: {
          cv: cv,
        },
      }),
      createOperator({
        type: "KeepKeys",
        params: {
          keep_keys: ["image", "shape"],
        },
      }),
    ];

    const size = 640 * 640 * 3;

    // 0〜255 を繰り返す flat リスト
    const flat: number[] = new Array(size).fill(0).map((_, i) => i % 256);

    console.log(flat);

    const img = cv.matFromArray(640, 640, cv.CV_8UC3, Uint8Array.from(flat));

    console.log(matToLine(img, cv));

    const inputs = {
      image: img,
      shape: null,
    };

    const transformed = transform(inputs, preprocess_op) as DataValues[];

    const transformed_img = transformed[0]! as NdArray;
    const shape = transformed[1]! as [number, number, number, number];

    const transformed_list = (ndArrayToList(transformed_img) as number[][][])
      .flat(2)
      .map((num) => Math.trunc(num * 1e4) / 1e4);

    expect(shape).toEqual([640, 640, 1, 1]);
    expect(transformed_list.slice(0, 1000)).toEqual(result_1000.slice(0, 1000));
  });
});
